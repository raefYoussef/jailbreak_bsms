{% extends "blank_template.html" %}
<!-- **************************************************************** -->  
<!-- **************************************************************** -->	
	{% block page_title %} Edit Inventory {% endblock %}
<!-- **************************************************************** -->  
<!-- **************************************************************** -->	
	{% block stylesheets %}
 <!-- DataTables CSS -->
		<link href="{{url_for('static', filename='DataTables/DataTables-1.10.13/css/dataTables.bootstrap.min.css')}}" rel="stylesheet">
  <!-- <link href="{{url_for('static', filename='DataTables/Buttons-1.2.4/css/buttons.bootstrap.min.css')}}" rel="stylesheet">-->
		<link href="{{url_for('static', filename='DataTables/ColReorder-1.3.2/css/colReorder.bootstrap.min.css')}}" rel="stylesheet">
		<link href="{{url_for('static', filename='DataTables/FixedHeader-3.1.2/css/fixedHeader.bootstrap.min.css')}}" rel="stylesheet">
		<link href="{{url_for('static', filename='DataTables/Responsive-2.1.1/css/responsive.bootstrap.min.css')}}" rel="stylesheet">
		<link href="{{url_for('static', filename='DataTables/Scroller-1.4.2/css/scroller.bootstrap.min.css')}}" rel="stylesheet">
   <link href="{{url_for('static', filename='DataTables/Select-1.2.0/css/select.bootstrap.min.css')}}" rel="stylesheet">
   
   <!-- style of textarea
  {% endblock %}
 <!-- **************************************************************** -->  
<!-- **************************************************************** -->
	
	{% block account_name %} {{ account_name }} {% endblock %}
<!-- **************************************************************** -->  
<!-- **************************************************************** -->	
	{% block sidebar %}
		<li>
			<a href="/dashboard/"><i class="fa fa-fw fa-dashboard"></i> Dashboard</a>
		</li>
		<li>
			<a href="/view_inventory/"><i class="fa fa-fw fa-table"></i> View Inventory</a>
		</li>
		<li class="active">
			<a href="/edit_inventory/"><i class="fa fa-fw fa-edit"></i> Edit Inventory</a>
		</li>
		<li>
			<a href="/logistics/"><i class="fa fa-fw fa-bar-chart-o"></i> Logistics</a>
		</li>
	{% endblock %}
<!-- **************************************************************** -->  
<!-- **************************************************************** -->
	{% block page_heading %} Edit Inventory {% endblock %}
<!-- **************************************************************** -->  
<!-- **************************************************************** -->	
	{% block page_subheading %}{% endblock %}
<!-- **************************************************************** -->  
<!-- **************************************************************** -->	
	{% block breadcrumbs %}
		<li>
			<i class="fa fa-dashboard"></i> <a href="/dashboard/">Dashboard</a>
		</li>
		<li class="active">
			<i class="fa fa-edit"></i> Edit Inventory
		</li>
	{% endblock %}
<!-- **************************************************************** -->  
<!-- **************************************************************** -->
	{% block alerts %}{% endblock %}
 <!-- **************************************************************** -->  
<!-- **************************************************************** -->
 <!-- **************************************************************** -->
 <!-- Body of hidden textbox and scan buttons -->
	{% block body %}
  <div class="row1">
				<div class="col-lg-12">
					<div class="panel panel-default">
						
<!-------Text area to enter tags------------>

<h3>Please Scan Tags Here</h3>

<textarea id="tag" disabled autofocus style="width:99%" col="5" placeholder="Scanned RFID tag numbers go here."></textarea>
<!-------start scan button------------>
<button type="button" id="start" class="btn btn-success">Start Scan</button>
<!-------stop scan button------------>
<button type="button" id="stop" class="btn btn-danger" disabled>Stop Scan</button>

<!-- **********************Table*********************************** -->
<div class="panel-heading" id = "ph1">
							Inventory
						</div>
						<!-- /.panel-heading -->
<div class="panel-body" id ="p1">
							<table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-inventory">
								
								<tbody>
									<thead>
									<tr>
										<th>ID</th>
										<th>Keg Type</th>
										<th>Status</th>
										<th>Beer Brand</th>
										<th>Time In</th>
										<th>Time Cleaned</th>
										<th>Time Filled</th>
										<th>Time Shipped</th>
										<th>Customer</th>
										<th>Note</th>
								    </tr>
								</thead>
								</tbody>
							</table>
							<!-- /.table-responsive -->
						</div>
						<!-- /.panel-body -->
<!-- **************************************************************** -->
<button type="button" id="delete_inv" class="btn btn-danger" title="Delete from Database">Delete</button>
<button type="button" id="edit_update" class="btn btn-warning" data-toggle="modal" data-target="#myModal1" title="Edit and update to Database">Edit & Update</button>
<!-- *************************Modal1 code****************************** -->
  <!-- Modal -->
  <div class="modal fade" id="myModal1" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Please Edit Keg ID here</h4>
        </div>
        <div class="modal-body">

          <label>ID:</label>
          <input type = "text"
                 id = "id_inv"
                 value = ""></input>
                 <p></p>
           <label>Keg Type:</label>
          <select id = "kegtype_inv">
 	 		<option value="HB">HB</option>
 			 <option value="QB">QB</option>
			</select>		
		<p></p>
	<label>Status:</label>
          <select id = "status_inv">
 	 		<option value="dirty">DIRTY</option>
 			 <option value="clean">CLEAN</option>
 			 <option value="fullout">FULL OUT</option>
 			 <option value="fullinv">FULL INV</option>
		</select>		
                 <p></p>
    <label>Beer Brand:</label>
         <select id = "beerbrand_inv">
          	 <option value="punisher">Big Punisher</option>
          	 <option value="cask">Cask Special</option>	
          	 <option value="czech">Czech the Technique</option>
          	 <option value="monkey">Feed The Monkey</option>
          	 <option value="dark">Into The Dark</option>	 
 			 <option value="ruca">My Ruca</option>
 			 <option value="righteous">Poor Righteous</option>
 			 <option value="smoke">Smokehouse 54</option>
 	 		 <option value="infinite">The Infinite</option>
 			 <option value="is50">This Is 50</option>
 			 <option value="scoville">Welcome To Scoville</option>	 			 			 
		</select>
		<p></p>
	<label>Time In:</label>
          <input type = "date"
                 id = "timein_inv"
                 value = "" ></input>
                 <p></p>
           <label>Time Cleaned:</label>
          <input type =  "date"
                 id = "timecleaned_inv"
                 value = "" >
		<p></p>
	<label>Time Filled:</label>
          <input type =  "date"
                 id = "timefilled_inv"
                 value = "" ></input>
                 <p></p>
           <label>Time Shipped:</label>
          <input type =  "date"
                 id = "timeshipped_inv"
                 value = "" ></input>
	<p></p>
	<label>Customer:</label>
          <input type = "text"
                 id = "customer_inv"
                 value = "" ></input>
                 <p></p>
           <label>Notes:</label>
          <input type = "text"
                 id = "notes_inv"
                 value = "" ></input>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Submit</button>
        </div>
      </div>
      
    </div>
  </div>
<!-- **************************************************************** -->

</div>
<!-- /.panel -->
	</div>
	<!-- /.col-lg-12 -->
	</div>
	<!-- /.row -->
<!-- **************************************************************** -->

<!-- **********************Table for Raw Scanned RFIDs*********************************** -->
  <div class="row2">
				<div class="col-lg-12">
					<div class="panel panel-default">
            <div class="panel-heading" id ="ph2">
							Unidentified Kegs
						</div>
						<!-- /.panel-heading -->
<div class="panel-body" id ="p2">
			<table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-inventory1">
								<thead>
									<tr>
										<th>#</th>
										<th>Scanned RFID Tag Numbers</th>
								    </tr>
								</thead>
								<tbody>
								
								</tbody>
							</table>
							<!-- /.table-responsive1 -->
						</div>
						<!-- /.panel-body1 -->

<!-- **************************************************************** -->
<button type="button" id="delete" class="btn btn-danger" title="Temporarily delete tag ID" >Delete</button>
<!-- Trigger the modal with a button -->
  <button type="button" class="btn btn-info" data-toggle="modal" data-target="#myModal" title ="Edit and Add to Database">Edit & Add</button>
<!-- *************************Modal code****************************** -->
  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Please Edit Keg ID here</h4>
        </div>
        <div class="modal-body">

          <label>ID:      </label>
          <input type = "text"
                 id = "id_inv"
                 value = ""></input>
                 <p></p>
           <label>Keg Type:</label>
          <select id = "kegtype_inv">
 	 		<option value="HB">HB</option>
 			 <option value="QB">QB</option>
			</select>				
                 <p></p>
           <label>Notes:   </label>
          <input type = "text"
                 id = "notes_inv"
                 value = "" ></input>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Submit</button>
        </div>
      </div>
      
    </div>
  </div>
<!-- **************************************************************** -->


</div>
<!-- /.panel -->
				</div>
				<!-- /.col-lg-12 -->
			</div>
			<!-- /.row -->
  

  {% endblock %}
<!-- **************************************************************** -->  
<!-- **************************************************************** -->
	{% block scripts %}
 <!--Global var for counter -->
  		<!-- DataTables JavaScript -->
		<script src="{{url_for('static', filename='DataTables/DataTables-1.10.13/js/jquery.dataTables.min.js')}}"></script>
		<script src="{{url_for('static', filename='DataTables/DataTables-1.10.13/js/dataTables.bootstrap.min.js')}}"></script>
   <!--<script src="{{url_for('static', filename='DataTables/Buttons-1.2.4/js/dataTables.buttons.min.js')}}"></script>-->
		<script src="{{url_for('static', filename='DataTables/ColReorder-1.3.2/js/dataTables.colReorder.min.js')}}"></script>
		<script src="{{url_for('static', filename='DataTables/FixedHeader-3.1.2/js/dataTables.fixedHeader.min.js')}}"></script>
		<script src="{{url_for('static', filename='DataTables/Responsive-2.1.1/js/dataTables.responsive.min.js')}}"></script>
		<script src="{{url_for('static', filename='DataTables/Responsive-2.1.1/js/responsive.bootstrap.min.js')}}"></script>
		<script src="{{url_for('static', filename='DataTables/Scroller-1.4.2/js/dataTables.scroller.min.js')}}"></script>
   <script src="{{url_for('static', filename='DataTables/Select-1.2.0/js/dataTables.select.min.js')}}"></script>
 <!--Added Scripts -->
 
 
 <script>
var counter = 1;
function doRow(i, newi, linesId){
	var epcData = jQuery.param({epc: linesId[i]});

	$.ajax({
		url:"/compare_epc/",
		data: epcData,
		dataType: "json",
		type: "POST",
		success: function(response){
			if(response["epc"].length != 0){
          		// keg exists in database
				$('#dataTables-inventory').DataTable().row.add([
					response["epc"][0]["keg_id"],
					response["epc"][0]["keg_type"],
					response["epc"][0]["status"],
					response["epc"][0]["beer_brand"],
					response["epc"][0]["time_in"],
					response["epc"][0]["time_cleaned"],
					response["epc"][0]["time_filled"],
					response["epc"][0]["time_shipped"],
					response["epc"][0]["customer"],
					response["epc"][0]["notes"]
				]).draw( false );
				//newi++;
				// console.log(response["epc"][0]["keg_type"]);
          	}
			else 
			{
          		// keg is not in the database
				$('#dataTables-inventory1').DataTable().row.add([
					counter,
					linesId[newi]             
				]).draw( false );
				//newi++;
				counter++;
			}
			//newi++;
			//newi++;
			
  		},
		error: function(error){
			alert("Error!!");
		}
	});
}
$(document).ready(function(){  
	
	// start scan button
    $("#start").click(function(){
		// Clear text area     
		// Reset text area
        $('#tag').val('');
		$("#tag").removeAttr('disabled');
		$("#stop").removeAttr('disabled');
		$("#start").prop("disabled", true);
		// $("#tag").hide("slow");     
    });
   
	// stop scan button   
	// get values from textarea, ignore if empty 
	$("#stop").click(function(){ 
		//Add a row if tag scanned is valid
		if ($.trim($('#tag').val()).length > 0) {
			// add a new row to the table
			// get line by line text from textarea
			var linesId = $('#tag').val().split('\n');
			
			var newi = 0;
			// add a new row to the table
			for (var i = 0; i < linesId.length; i++){
				doRow(i, newi, linesId);
				newi++;
			}
		}
        else {
        // The scanned tag number is invalid 
         alert("Invalid Input");
        }
        // Disable stop scan button and enable start scan button, disable textare again--> 
		$("#tag").attr('disabled', ''); 
		$("#start").removeAttr('disabled');
		$("#stop").prop("disabled", true); 
    }); 
//<!-------Delete button------------>    
//<!-------Multiple delete at once------------>
//<!-------Deletes selected row from unidentified keg table ------------>
    $("#delete").click(function(){
            ($('#dataTables-inventory1').DataTable())
            .rows('.selected')
            .remove()
            .draw();
    });
});<!-- noconflict -->
</script> 
<!--************************************************-->
<!--************************************************-->
	<!-- Inventory Table -->
		<script>
		$(document).ready(function() {
   
       $('#ph1').css({
            'color':'white',
            'background-color': 'black',
            'margin-top': '20px'});
  
			$('#dataTables-inventory').DataTable({
				responsive: true,
       			select: 'multi+shift'
			});

    //  <!-- Unidentified Kegs Table -->
      $('#ph2').css({
            'color':'white',
            'background-color': 'black',
            'margin-top': '20px'});
  //<!-- make it responsive and multiple select at one time -->
			$('#dataTables-inventory1').DataTable({
				responsive: true,
        		select: 'multi+shift'
			});
		});
		</script>
   <!--************************************************-->
  
  {% endblock %}

<!--************************************************-->
<!--************************************************-->



	

